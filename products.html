<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ù…Ø§Ù‡Ø± ÙÙˆÙ†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>.product-img { height: 230px; object-fit: contain; }</style>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-dark p-3">
    <div class="container d-flex justify-content-between">
        <a class="navbar-brand" href="index.html">ğŸ“± Ù…Ø§Ù‡Ø± ÙÙˆÙ†</a>
        <div>
            <button class="btn btn-outline-light me-2" onclick="location.href='admin.html'">ğŸ”§ Admin</button>
            <button class="btn btn-light" onclick="location.href='cart.html'">ğŸ›’ Ø§Ù„Ø³Ù„Ø©</button>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2 class="mb-3">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    <div id="allProducts" class="row g-3"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
    apiKey: "AIzaSyAAYSyJf1YPFU7bXB87hKuPSUzJ53G0tt4",
    authDomain: "maher-phone-18581.firebaseapp.com",
    projectId: "maher-phone-18581",
    storageBucket: "maher-phone-18581.appspot.com",
    messagingSenderId: "452858222210",
    appId: "1:452858222210:web:12fa439652c4aa0b48869b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

function addToCart(productId, name, price, img) {
    const user = auth.currentUser;
    if (!user) return alert("Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");

    const cartRef = db.collection("users").doc(user.uid).collection("cart");

    cartRef.add({
        productId,
        name,
        price,
        img,
        qty: 1,
        addedAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø© âœ“");
}

function loadProducts() {
    const container = document.getElementById('allProducts');

    db.collection("products").orderBy("createdAt", "desc").onSnapshot(snapshot => {
        container.innerHTML = "";

        if (snapshot.empty) {
            container.innerHTML = `
                <div class="alert alert-info">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯. Ø§ÙØªØ­ Admin Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª.</div>
            `;
            return;
        }

        snapshot.forEach(doc => {
            const p = doc.data();

            container.innerHTML += `
                <div class="col-md-3">
                    <div class="card p-2 shadow-sm">
                        <img src="${p.imageURL}" class="product-img mb-2" alt="${p.name}">
                        <h5>${p.name}</h5>
                        <p class="text-danger fw-bold">${p.price} Ø¬Ù†ÙŠÙ‡</p>
                        <button class="btn btn-dark" 
                            onclick="addToCart('${doc.id}', '${p.name}', ${p.price}, '${p.imageURL}')">
                            Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
                        </button>
                    </div>
                </div>
            `;
        });
    });
}

loadProducts();

</script>

</body>
</html>
