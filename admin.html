<!doctype html>
<html>
<head><meta charset="utf-8"><title>Admin - Add Product</title></head>
<body>
  <h1>لوحة الأدمن - أضف منتج</h1>
  <div id="authStatus"></div>
  <form id="productForm">
    <input id="pname" placeholder="اسم المنتج" required><br>
    <textarea id="pdesc" placeholder="الوصف"></textarea><br>
    <input id="pprice" placeholder="السعر" type="number" required><br>
    <input id="pimage" type="file" accept="image/*" required><br>
    <button type="submit">أضف المنتج</button>
  </form>
  <a href="index.html">العودة للموقع</a>

  <!-- Firebase SDK same versions as index -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <script>
    // ====== ضع هنا إعدادات Firebase من مشروعك (web app config) ======
    const firebaseConfig = {
      apiKey: "API_KEY",
      authDomain: "PROJECT_ID.firebaseapp.com",
      projectId: "PROJECT_ID",
      storageBucket: "PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const authStatus = document.getElementById('authStatus');
    auth.onAuthStateChanged(user => {
      if (!user) {
        authStatus.innerHTML = 'سجّل الدخول في index.html أولاً.';
      } else {
        authStatus.innerHTML = 'أدخل بواسطة: ' + user.email;
        if (user.email !== 'admin@example.com') {
          authStatus.innerHTML += ' — ليس لديك صلاحية الأدمن.';
          document.getElementById('productForm').style.display = 'none';
        }
      }
    });

    document.getElementById('productForm').onsubmit = async (e) => {
      e.preventDefault();
      const user = auth.currentUser;
      if (!user || user.email !== 'admin@example.com') { alert('ليس لديك صلاحية'); return; }

      const name = document.getElementById('pname').value;
      const desc = document.getElementById('pdesc').value;
      const price = parseFloat(document.getElementById('pprice').value);
      const file = document.getElementById('pimage').files[0];
      if (!file) { alert('اختر صورة'); return; }

      // رفع الصورة للـ Storage
      const storageRef = storage.ref().child('product_images/' + Date.now() + '_' + file.name);
      const snap = await storageRef.put(file);
      const url = await snap.ref.getDownloadURL();

      // إضافة المنتج للـ Firestore
      await db.collection('products').add({
        name, description: desc, price, imageURL: url, createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      alert('تمت إضافة المنتج');
      document.getElementById('productForm').reset();
    };
  </script>
</body>
</html>
