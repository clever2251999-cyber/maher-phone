<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<title>Maher Phone - المتجر</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
    body{
        font-family:"Cairo", sans-serif;
        direction:rtl;
        margin:0;
        background:#0a0a0f;
        color:#e8e8e8;
        padding-bottom:80px;
    }

    header{
        background:#111;
        padding:20px;
        color:#00eaff;
        text-align:center;
        font-size:26px;
        font-weight:700;
        box-shadow:0 2px 10px #00000040;
        position:sticky;
        top:0;
        z-index:100;
    }

    #categories{
        display:flex;
        overflow-x:auto;
        gap:12px;
        padding:15px;
        background:#0f0f14;
        border-bottom:1px solid #00aaff22;
    }

    .cat-btn{
        padding:10px 16px;
        background:#111;
        border:1px solid #00aaff55;
        color:#00eaff;
        border-radius:10px;
        cursor:pointer;
        white-space:nowrap;
        transition:0.25s;
    }

    .cat-btn:hover, .cat-btn.active{
        background:#00aaff33;
        border-color:#00eaff;
    }

    #product-list{
        padding:20px;
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
        gap:20px;
    }

    .product-card{
        background:#111;
        padding:15px;
        border-radius:14px;
        border:1px solid #00aaff33;
        box-shadow:0 0 12px #00aaff33;
    }

    .product-card img{
        width:100%;
        border-radius:10px;
    }

    .product-card h3{
        margin:10px 0 5px;
        color:#00eaff;
    }

    .product-card p{
        margin:5px 0;
        color:#ccc;
    }

    .add-btn{
        width:100%;
        padding:10px;
        margin-top:10px;
        background:#00aaff;
        color:#000;
        border:0;
        border-radius:8px;
        cursor:pointer;
        font-size:16px;
        font-weight:700;
        transition:0.25s;
    }

    .add-btn:hover{
        background:#00eaff;
    }

    /* زر الترس */
    #admin-btn{
        position:fixed;
        bottom:20px;
        left:20px;
        padding:14px 18px;
        background:#111;
        color:#00aaff;
        border:1px solid #00aaff55;
        border-radius:50px;
        font-size:22px;
        cursor:pointer;
        box-shadow:0 0 15px #00aaff55;
        transition:0.25s;
        z-index:9999;
    }

    #admin-btn:hover{
        background:#00aaff33;
        box-shadow:0 0 18px #00aaffaa;
    }
</style>
</head>

<body>

<header>Maher Phone - المتجر</header>

<div id="categories"></div>

<div id="product-list"></div>

<!-- زر الترس -->
<button id="admin-btn" onclick="goLogin()">⚙️</button>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

<script src="firebase.js"></script>

<script>

// تحميل الفئات
db.collection("categories").onSnapshot(snapshot=>{
    const catBox = document.getElementById("categories");
    catBox.innerHTML = "";

    catBox.innerHTML += `<button class="cat-btn active" onclick="loadProducts('all')">الكل</button>`;

    snapshot.forEach(cat=>{
        catBox.innerHTML += `
            <button class="cat-btn" onclick="loadProducts('${cat.id}')">${cat.data().name}</button>
        `;
    });
});

// تحميل المنتجات
function loadProducts(category){
    const productList = document.getElementById("product-list");
    productList.innerHTML = `<p>جار التحميل...</p>`;

    let ref = db.collection("products");
    if(category !== "all") ref = ref.where("category", "==", category);

    ref.get().then(snapshot=>{
        productList.innerHTML = "";
        snapshot.forEach(prod=>{
            const p = prod.data();

            productList.innerHTML += `
                <div class="product-card">
                    <img src="${p.image}" alt="">
                    <h3>${p.name}</h3>
                    <p>${p.desc}</p>
                    <p><b>${p.price} جنيه</b></p>
                    <button class="add-btn" onclick="addToCart('${prod.id}', '${p.name}', '${p.price}', '${p.image}')">أضف للسلة</button>
                </div>
            `;
        });
    });
}

// إضافة للسلة
function addToCart(id, name, price, image){
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");

    const found = cart.find(item=> item.id === id);
    if(found) found.qty++;
    else cart.push({ id, name, price, image, qty:1 });

    localStorage.setItem("cart", JSON.stringify(cart));
    alert("تمت الإضافة للسلة");
}

// زر الترس → صفحة تسجيل الدخول
function goLogin(){
    location.href = "login.html";
}

loadProducts("all");

</script>
</body>
</html>
