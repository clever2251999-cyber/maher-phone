<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<title>Ø§Ù„Ø³Ù„Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;direction:rtl;background:#f5f5f5;margin:0;padding:20px;}
.card{background:#fff;padding:15px;margin-bottom:10px;border-radius:10px;box-shadow:0 0 8px #00000022;}
input,button{width:100%;padding:10px;margin:8px 0;border:1px solid #ccc;border-radius:6px;}
button{background:#2196f3;color:white;border:none;cursor:pointer;}
</style>
</head>

<body>

<h2>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>

<div id="cart-items"></div>

<h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">

<button onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase.js"></script>

<script>

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø©
function loadCart(){
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const box = document.getElementById("cart-items");

    if(cart.length === 0){
        box.innerHTML = "<p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>";
        return;
    }

    let html = "";
    cart.forEach((item,i)=>{
        html += `
        <div class="card">
            <b>${item.name}</b><br>
            Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬Ù†ÙŠÙ‡<br>
            <button onclick="deleteItem(${i})">Ø­Ø°Ù</button>
        </div>`;
    });
    box.innerHTML = html;
}

function deleteItem(i){
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    cart.splice(i,1);
    localStorage.setItem("cart", JSON.stringify(cart));
    loadCart();
}

loadCart();


// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Firestore
async function sendOrder(){
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const address = document.getElementById("address").value.trim();
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");

    if(!name || !phone || !address || cart.length === 0){
        alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");
        return;
    }

    try {
        await db.collection("orders").add({
            name,
            phone,
            address,
            cart,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        localStorage.removeItem("cart");

        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
        location.href = "products.html";

    } catch (err) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
        console.log(err);
    }
}

</script>

</body>
</html>
