<script>
const ADMIN = "clever2251999@gmail.com";
const authStatus = document.getElementById('authStatus');
const productForm = document.getElementById('productForm');

const storage = firebase.storage();   <!-- ★★ السطر المهم ★★ -->

auth.onAuthStateChanged(user=>{
  if(!user){ authStatus.textContent = "سجل دخول أولاً من الصفحة الرئيسية."; return; }
  if(!user.email || user.email !== ADMIN){ authStatus.textContent = "ليس لديك صلاحية."; return; }
  authStatus.style.color = 'green';
  authStatus.textContent = 'أدمن: ' + user.email;
  productForm.style.display = 'block';
});

productForm.onsubmit = async (e) => {
  e.preventDefault();
  const name = document.getElementById('pname').value.trim();
  const desc = document.getElementById('pdesc').value.trim();
  const price = parseFloat(document.getElementById('pprice').value);
  const file = document.getElementById('pimage').files[0];

  if(!file) return alert('اختر صورة');

  try{
    const storageRef = storage.ref().child('product_images/' + Date.now() + '_' + file.name);
    const snap = await storageRef.put(file);
    const url = await snap.ref.getDownloadURL();

    await db.collection('products').add({
      name,
      description: desc,
      price,
      imageURL: url,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert('تمت إضافة المنتج');
    productForm.reset();
  } catch(e){ alert(e.message); }
};
</script>
